nohup: ignoring input
/root/autodl-tmp/vectormark/utils1.py:17: LangChainDeprecationWarning: As of langchain-core 0.3.0, LangChain uses pydantic v2 internally. The langchain_core.pydantic_v1 module was a compatibility shim for pydantic v1, and should no longer be used. Please update the code to import from Pydantic directly.

For example, replace imports like: `from langchain_core.pydantic_v1 import BaseModel`
with: `from pydantic import BaseModel`
or the v1 compatibility namespace if you are working in a code base that has not been fully upgraded to pydantic 2 yet. 	from pydantic.v1 import BaseModel

  from KGW.KGW_claude import KGWWatermarkedLLM
INFO:root:Initializing corrected watermark detection...
INFO:root:Loaded 127 rewrite mappings
INFO:root:Original watermark bits: [1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1]
INFO:root:Candidate attributes: [('country', 'price', '', ''), ('country', '', 'taster_name', ''), ('country', '', 'taster_name', 'taster_twitter_handle'), ('', 'price', '', 'taster_twitter_handle'), 'id', 'winery']
INFO:root:Loading detection model...
INFO:datasets:PyTorch version 2.6.0+cu124 available.
INFO:datasets:Polars version 1.31.0 available.
Loaded dataset with 50000 records
Loading model: ../model/Qwen/Qwen2.5-32B-Instruct-GPTQ-Int8

[32mINFO[0m  ENV: Auto setting CUDA_DEVICE_ORDER=PCI_BUS_ID for correctness.          
[32mINFO[0m   Kernel: Auto-selection: adding candidate `TritonV2QuantLinear`          
`loss_type=None` was set in the config but it is unrecognised.Using the default loss: `ForCausalLMLoss`.
INFO:accelerate.utils.modeling:We will use 90% of the memory on device 0 for storing the model, and 10% for the buffer to avoid OOM. You can set `max_memory` in to a higher value to use more memory (at your own risk).
Loading checkpoint shards:   0%|          | 0/9 [00:00<?, ?it/s]Loading checkpoint shards:  11%|█         | 1/9 [00:00<00:04,  1.67it/s]Loading checkpoint shards:  22%|██▏       | 2/9 [00:01<00:04,  1.48it/s]Loading checkpoint shards:  33%|███▎      | 3/9 [00:02<00:04,  1.42it/s]Loading checkpoint shards:  44%|████▍     | 4/9 [00:02<00:03,  1.39it/s]Loading checkpoint shards:  56%|█████▌    | 5/9 [00:03<00:02,  1.38it/s]Loading checkpoint shards:  67%|██████▋   | 6/9 [00:04<00:02,  1.37it/s]Loading checkpoint shards:  78%|███████▊  | 7/9 [00:05<00:01,  1.37it/s]Loading checkpoint shards:  89%|████████▉ | 8/9 [00:05<00:00,  1.37it/s]Loading checkpoint shards: 100%|██████████| 9/9 [00:06<00:00,  1.49it/s]Loading checkpoint shards: 100%|██████████| 9/9 [00:06<00:00,  1.43it/s]
[32mINFO[0m  Format: Converting `checkpoint_format` from `gptq` to internal `gptq_v2`.
[32mINFO[0m  Format: Converting GPTQ v1 to v2                                         
[32mINFO[0m  Format: Conversion complete: 0.013930082321166992s                       
[32mINFO[0m  Optimize: `TritonV2QuantLinear` compilation triggered.                   
INFO:root:Starting detection on 50000 records
Model loaded successfully
Detecting watermark v3:   0%|          | 0/50000 [00:00<?, ?it/s]Detecting watermark v3:   0%|          | 221/50000 [00:00<01:30, 548.40it/s]Detecting watermark v3:   1%|▏         | 669/50000 [00:00<00:51, 955.13it/s]Detecting watermark v3:   2%|▏         | 1082/50000 [00:01<00:46, 1063.22it/s]Detecting watermark v3:   3%|▎         | 1679/50000 [00:01<00:35, 1343.60it/s]Detecting watermark v3:   6%|▌         | 2922/50000 [00:01<00:22, 2112.10it/s]Detecting watermark v3:   7%|▋         | 3457/50000 [00:02<00:23, 1956.21it/s]Detecting watermark v3:   8%|▊         | 3971/50000 [00:02<00:25, 1838.97it/s]Detecting watermark v3:   8%|▊         | 4247/50000 [00:02<00:29, 1553.72it/s]Detecting watermark v3:  10%|▉         | 4873/50000 [00:03<00:27, 1659.66it/s]Detecting watermark v3:  13%|█▎        | 6251/50000 [00:03<00:18, 2317.89it/s]Detecting watermark v3:  13%|█▎        | 6476/50000 [00:03<00:23, 1877.21it/s]Detecting watermark v3:  13%|█▎        | 6691/50000 [00:04<00:28, 1533.96it/s]Detecting watermark v3:  14%|█▍        | 7127/50000 [00:04<00:28, 1483.56it/s]Detecting watermark v3:  16%|█▌        | 7999/50000 [00:04<00:23, 1816.12it/s]Detecting watermark v3:  17%|█▋        | 8722/50000 [00:05<00:21, 1919.57it/s]Detecting watermark v3:  18%|█▊        | 9091/50000 [00:05<00:24, 1642.12it/s]Detecting watermark v3:  19%|█▉        | 9467/50000 [00:05<00:26, 1503.18it/s]Detecting watermark v3:  20%|██        | 10230/50000 [00:06<00:23, 1727.19it/s]Detecting watermark v3:  21%|██        | 10413/50000 [00:06<00:28, 1400.21it/s]Detecting watermark v3:  21%|██        | 10559/50000 [00:06<00:34, 1135.15it/s]Detecting watermark v3:  22%|██▏       | 10995/50000 [00:07<00:32, 1204.01it/s]Detecting watermark v3:  22%|██▏       | 11222/50000 [00:07<00:37, 1033.23it/s]Detecting watermark v3:  23%|██▎       | 11480/50000 [00:07<00:39, 974.02it/s] Detecting watermark v3:  23%|██▎       | 11673/50000 [00:08<00:44, 864.11it/s]Detecting watermark v3:  25%|██▍       | 12391/50000 [00:08<00:29, 1262.73it/s]Detecting watermark v3:  27%|██▋       | 13523/50000 [00:08<00:19, 1834.98it/s]Detecting watermark v3:  27%|██▋       | 13700/50000 [00:09<00:24, 1480.57it/s]Detecting watermark v3:  28%|██▊       | 13984/50000 [00:09<00:27, 1315.08it/s]Detecting watermark v3:  28%|██▊       | 14155/50000 [00:09<00:33, 1081.09it/s]Detecting watermark v3:  31%|███       | 15349/50000 [00:10<00:19, 1754.07it/s]Detecting watermark v3:  31%|███       | 15514/50000 [00:10<00:25, 1379.30it/s]Detecting watermark v3:  31%|███▏      | 15726/50000 [00:10<00:29, 1169.11it/s]Detecting watermark v3:  32%|███▏      | 15843/50000 [00:11<00:36, 939.24it/s] Detecting watermark v3:  32%|███▏      | 15932/50000 [00:11<00:57, 587.51it/s]Detecting watermark v3:  32%|███▏      | 16178/50000 [00:11<00:53, 637.50it/s]Detecting watermark v3:  33%|███▎      | 16320/50000 [00:12<00:57, 584.92it/s]Detecting watermark v3:  33%|███▎      | 16615/50000 [00:12<00:49, 676.22it/s]Detecting watermark v3:  34%|███▍      | 17148/50000 [00:12<00:34, 942.30it/s]Detecting watermark v3:  35%|███▍      | 17270/50000 [00:13<00:41, 783.79it/s]Detecting watermark v3:  36%|███▌      | 17858/50000 [00:13<00:30, 1067.69it/s]Detecting watermark v3:  36%|███▋      | 18212/50000 [00:13<00:29, 1074.17it/s]Detecting watermark v3:  39%|███▊      | 19337/50000 [00:14<00:18, 1692.59it/s]Detecting watermark v3:  40%|███▉      | 19824/50000 [00:14<00:18, 1624.27it/s]Detecting watermark v3:  40%|████      | 20072/50000 [00:14<00:21, 1372.87it/s]Detecting watermark v3:  40%|████      | 20207/50000 [00:15<00:27, 1083.69it/s]Detecting watermark v3:  41%|████      | 20313/50000 [00:15<00:34, 865.27it/s] Detecting watermark v3:  41%|████      | 20585/50000 [00:15<00:34, 855.23it/s]Detecting watermark v3:  42%|████▏     | 20763/50000 [00:16<00:38, 764.53it/s]Detecting watermark v3:  42%|████▏     | 20943/50000 [00:16<00:41, 696.47it/s]Detecting watermark v3:  43%|████▎     | 21254/50000 [00:16<00:37, 776.64it/s]Detecting watermark v3:  44%|████▎     | 21755/50000 [00:17<00:28, 1006.63it/s]Detecting watermark v3:  45%|████▍     | 22444/50000 [00:17<00:21, 1310.55it/s]Detecting watermark v3:  45%|████▌     | 22574/50000 [00:17<00:26, 1046.06it/s]Detecting watermark v3:  47%|████▋     | 23395/50000 [00:18<00:18, 1445.03it/s]Detecting watermark v3:  48%|████▊     | 23845/50000 [00:18<00:18, 1413.25it/s]Detecting watermark v3:  48%|████▊     | 24136/50000 [00:18<00:20, 1261.98it/s]Detecting watermark v3:  49%|████▊     | 24372/50000 [00:19<00:22, 1117.53it/s]Detecting watermark v3:  49%|████▉     | 24482/50000 [00:19<00:28, 894.91it/s] Detecting watermark v3:  49%|████▉     | 24570/50000 [00:19<00:35, 709.86it/s]Detecting watermark v3:  49%|████▉     | 24640/50000 [00:20<00:44, 567.16it/s]Detecting watermark v3:  50%|█████     | 25112/50000 [00:20<00:30, 813.41it/s]Detecting watermark v3:  53%|█████▎    | 26349/50000 [00:20<00:14, 1614.49it/s]Detecting watermark v3:  53%|█████▎    | 26501/50000 [00:21<00:18, 1288.00it/s]Detecting watermark v3:  54%|█████▍    | 27025/50000 [00:21<00:16, 1368.84it/s]Detecting watermark v3:  54%|█████▍    | 27217/50000 [00:21<00:19, 1145.87it/s]Detecting watermark v3:  56%|█████▌    | 27800/50000 [00:22<00:16, 1326.65it/s]Detecting watermark v3:  57%|█████▋    | 28421/50000 [00:22<00:14, 1481.75it/s]Detecting watermark v3:  58%|█████▊    | 29133/50000 [00:22<00:12, 1654.59it/s]Detecting watermark v3:  59%|█████▊    | 29297/50000 [00:23<00:15, 1337.63it/s]Detecting watermark v3:  59%|█████▉    | 29428/50000 [00:23<00:24, 837.68it/s] Detecting watermark v3:  61%|██████    | 30277/50000 [00:24<00:15, 1253.81it/s]Detecting watermark v3:  61%|██████    | 30417/50000 [00:24<00:18, 1046.56it/s]Detecting watermark v3:  61%|██████    | 30578/50000 [00:24<00:21, 907.79it/s] Detecting watermark v3:  63%|██████▎   | 31610/50000 [00:25<00:12, 1500.41it/s]Detecting watermark v3:  64%|██████▍   | 32066/50000 [00:25<00:12, 1440.72it/s]Detecting watermark v3:  65%|██████▍   | 32388/50000 [00:25<00:13, 1304.40it/s]Detecting watermark v3:  68%|██████▊   | 34209/50000 [00:26<00:06, 2385.86it/s]Detecting watermark v3:  69%|██████▉   | 34439/50000 [00:26<00:10, 1540.36it/s]Detecting watermark v3:  70%|██████▉   | 34948/50000 [00:27<00:09, 1528.30it/s]Detecting watermark v3:  71%|███████   | 35512/50000 [00:27<00:09, 1566.75it/s]Detecting watermark v3:  72%|███████▏  | 35990/50000 [00:27<00:09, 1489.75it/s]Detecting watermark v3:  73%|███████▎  | 36361/50000 [00:28<00:09, 1383.34it/s]Detecting watermark v3:  74%|███████▎  | 36872/50000 [00:28<00:09, 1415.48it/s]Detecting watermark v3:  74%|███████▍  | 37250/50000 [00:28<00:09, 1338.83it/s]Detecting watermark v3:  75%|███████▍  | 37386/50000 [00:29<00:11, 1098.53it/s]Detecting watermark v3:  76%|███████▌  | 38054/50000 [00:29<00:08, 1352.55it/s]Detecting watermark v3:  77%|███████▋  | 38612/50000 [00:29<00:08, 1402.29it/s]Detecting watermark v3:  78%|███████▊  | 38751/50000 [00:30<00:12, 867.82it/s] Detecting watermark v3:  78%|███████▊  | 38928/50000 [00:30<00:13, 800.74it/s]Detecting watermark v3:  78%|███████▊  | 39141/50000 [00:31<00:14, 769.57it/s]Detecting watermark v3:  79%|███████▊  | 39356/50000 [00:31<00:14, 745.67it/s]Detecting watermark v3:  80%|███████▉  | 39844/50000 [00:31<00:10, 955.85it/s]Detecting watermark v3:  80%|███████▉  | 39999/50000 [00:32<00:12, 831.21it/s]Detecting watermark v3:  80%|████████  | 40175/50000 [00:32<00:12, 757.34it/s]Detecting watermark v3:  81%|████████  | 40351/50000 [00:32<00:13, 704.66it/s]Detecting watermark v3:  81%|████████  | 40422/50000 [00:33<00:16, 568.48it/s]Detecting watermark v3:  81%|████████  | 40557/50000 [00:33<00:17, 527.95it/s]Detecting watermark v3:  81%|████████▏ | 40724/50000 [00:33<00:17, 527.43it/s]Detecting watermark v3:  82%|████████▏ | 41233/50000 [00:34<00:10, 838.58it/s]Detecting watermark v3:  83%|████████▎ | 41559/50000 [00:34<00:09, 889.50it/s]Detecting watermark v3:  83%|████████▎ | 41667/50000 [00:34<00:11, 735.53it/s]Detecting watermark v3:  84%|████████▎ | 41758/50000 [00:35<00:13, 604.28it/s]Detecting watermark v3:  85%|████████▌ | 42714/50000 [00:35<00:05, 1260.93it/s]Detecting watermark v3:  86%|████████▌ | 42832/50000 [00:36<00:09, 795.83it/s] Detecting watermark v3:  87%|████████▋ | 43400/50000 [00:36<00:06, 1031.74it/s]Detecting watermark v3:  88%|████████▊ | 44145/50000 [00:36<00:04, 1346.54it/s]Detecting watermark v3:  89%|████████▊ | 44291/50000 [00:36<00:05, 1124.83it/s]Detecting watermark v3:  90%|████████▉ | 44970/50000 [00:37<00:03, 1394.32it/s]Detecting watermark v3:  91%|█████████ | 45454/50000 [00:37<00:03, 1416.79it/s]Detecting watermark v3:  92%|█████████▏| 45770/50000 [00:37<00:03, 1303.41it/s]Detecting watermark v3:  92%|█████████▏| 45910/50000 [00:38<00:03, 1058.77it/s]Detecting watermark v3:  92%|█████████▏| 46153/50000 [00:38<00:03, 973.29it/s] Detecting watermark v3:  92%|█████████▎| 46250/50000 [00:38<00:04, 779.24it/s]Detecting watermark v3:  93%|█████████▎| 46521/50000 [00:39<00:04, 806.73it/s]Detecting watermark v3:  95%|█████████▍| 47442/50000 [00:39<00:01, 1389.45it/s]Detecting watermark v3:  95%|█████████▌| 47667/50000 [00:39<00:01, 1191.82it/s]Detecting watermark v3:  96%|█████████▌| 47805/50000 [00:40<00:02, 979.89it/s] Detecting watermark v3:  97%|█████████▋| 48607/50000 [00:40<00:01, 1332.79it/s]Detecting watermark v3:  97%|█████████▋| 48746/50000 [00:40<00:01, 1077.33it/s]Detecting watermark v3:  98%|█████████▊| 48921/50000 [00:41<00:01, 920.17it/s] Detecting watermark v3:  98%|█████████▊| 49008/50000 [00:41<00:01, 736.31it/s]Detecting watermark v3:  99%|█████████▉| 49403/50000 [00:41<00:00, 886.49it/s]Detecting watermark v3: 100%|██████████| 50000/50000 [00:41<00:00, 1193.69it/s]
INFO:root:
=== Simplified Watermark Detection Summary ===
INFO:root:Original Watermark Bits: [1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1]
INFO:root:Overall Match Rate: 56.25%
INFO:root:Detectable Bits: 16/16
INFO:root:
Bit-Level Statistics:
INFO:root:Bit | Embed_Count | Tend_to_0 | Tend_to_1 | Z_Score_0 | Z_Score_1 | Original | Detected | Match
INFO:root:-----------------------------------------------------------------------------------------------
INFO:root:  0 |           5 |         3 |         2 |      3.09 |      2.86 |        1 |        0 | ✗    
INFO:root:  1 |           7 |         2 |         5 |     -8.37 |      7.45 |        1 |        1 | ✓    
INFO:root:  2 |           9 |         2 |         7 |      3.91 |      7.15 |        1 |        1 | ✓    
INFO:root:  3 |          10 |         7 |         3 |     19.89 |      7.81 |        0 |        0 | ✓    
INFO:root:  4 |           5 |         1 |         4 |     -6.06 |      8.92 |        1 |        1 | ✓    
INFO:root:  5 |           9 |         3 |         6 |      2.37 |      7.13 |        1 |        1 | ✓    
INFO:root:  6 |           8 |         6 |         2 |      5.80 |      4.70 |        1 |        0 | ✗    
INFO:root:  7 |           4 |         2 |         2 |     -2.40 |     -7.67 |        1 |        1 | ✓    
INFO:root:  8 |           5 |         3 |         2 |      3.33 |      4.13 |        0 |        0 | ✓    
INFO:root:  9 |           5 |         1 |         4 |      0.87 |      0.44 |        0 |        1 | ✗    
INFO:root: 10 |          14 |         8 |         6 |     10.99 |      9.92 |        1 |        0 | ✗    
INFO:root: 11 |           9 |         1 |         8 |      1.95 |     20.45 |        1 |        1 | ✓    
INFO:root: 12 |           5 |         2 |         3 |      6.10 |     11.88 |        1 |        1 | ✓    
INFO:root: 13 |           9 |         5 |         4 |     21.28 |      5.64 |        1 |        0 | ✗    
INFO:root: 14 |          16 |         6 |        10 |      1.79 |      7.63 |        0 |        1 | ✗    
INFO:root: 15 |           7 |         4 |         3 |     11.46 |      5.58 |        1 |        0 | ✗    
Detection results saved to ./data/det_res/detection_results_winemag50k_g587.json
